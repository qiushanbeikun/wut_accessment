import {useNavigate, useParams} from "react-router-dom";
import styled from "@emotion/styled";
import {Button, Grid, TextField} from "@mui/material";
import {useFormik} from "formik";
import * as yup from "yup";
import {useContact, useContactCreate, useContactDelete, useContactUpdate} from "../api/contact";
import {IMAGE_SIZE_LIMIT} from "./Constants";

const ContactWrapper = styled.div`
  text-align: center;
`;

const ProfileImage = styled.img`
  width: 40%;
  margin: 1em;
`;

const DEFAULT_PROFILE = "data:image/bmp;base64,Qk1mdQAAAAAAADYAAAAoAAAAZAAAAGQAAAABABgAAAAAADB1AAAAAAAAAAAAAAAAAAAAAAAA////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////tv//AABmZgAA//+2////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////tv//AABmZgAA//+2////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////tv//AABmZgAA//+2////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////OpDbAAAAAAAA27ZmADqQAAAA/7Zmtv//AABmZgAAkNu2AAA6AAAAZgAA//+2////tv//AABmOgAA/9uQ////2///ADqQAAAAAAAAAAAAtmYA////////2///ADqQAAAAAAAAkJA6AABmZgAA//+2////kNv/AAA6AAAAZgAAkNu2AAA6ZgAA//+2////2///ADqQAAAAAAAAAAAAkDoA///b////kNv/AAA6AAAAZgAAkNu2AAA6ZgAA//+2////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////kNv/AAA6AAAAAAAAAAAAAAAAAAAA/7Zmtv//AABmAAAAAAAAAAAAAAAAAAAAZgAA//+2tv//AABmOgAA/9uQtv//AABmAAAAAAAAAAAAAAAAAAAAkDoA///bOpDbAAAAAAAAAAAAAAAAAAAAZgAA//+2kNv/AAA6AAAAAAAAAAAAAAAAAAAAZgAA//+2tv//AABmAAAAAAAAAAAAAAAAkDoA///bkNv/AAA6AAAAAAAAAAAAAAAAAAAAZgAA//+2////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////Zrb/AAAAZgAA//+2tv//AABmAAAA/7Zmtv//AABmAAAA/7Zm////kNv/AAA6AAAA/7Zmtv//AABmOgAA/9uQZrb/AAAAZgAA//+2////tv//AABmAAAA/7ZmZrb/AAAA25A6////tv//AABmZgAA//+2OpDbAAAAZgAA//+2////OpDbAAAAZgAA//+2Zrb/AAAAkDoA///b////////////////OpDbAAAAZgAA//+2////OpDbAAAAZgAA//+2////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////Zrb/AAAAkDoA///b2///ADqQAAAA/7Zmtv//AABmZgAA//+2////////AGa2AAAA25A6tv//AABmOgAA/9uQOpDbAAAAtmYA////////////AGa2AAAA25A6////AGa2AAAAAAAAAAAAAAAAZgAA//+2OpDbAAAAtmYA////////kNv/AAA6ZgAA//+2Zrb/AAAAAAAAAAAAAAAAAAAAAAAA25A6OpDbAAAAtmYA////////kNv/AAA6ZgAA//+2////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////Zrb/AAAAkDoA///b2///ADqQAAAA/7Zmtv//AABmAAAA/7Zm////tv//AABmAAAA25A6tv//AABmOgAA/9uQZrb/AAAAOgAA/9uQ////tv//AABmAAAA/7Zm////////////////tv//AABmZgAA//+2Zrb/AAAAZgAA//+2////Zrb/AAAAZgAA//+2Zrb/AAAAZgAA//+2////OpDbAAAA25A6Zrb/AAAAZgAA//+2////Zrb/AAAAZgAA//+2////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////Zrb/AAAAkDoA///b2///ADqQAAAA/7Zmtv//AABmOgAAADo6AAAAAAAAAAAAOgAA/9uQtv//AABmOgAA/9uQ2///ADqQAAAAAAAAAAAAAAAAAAAAZgAA//+22///ADqQAAAAAAAAAAAAAAAAkDoA///btv//AABmAAAAAAAAAAAAAAAAAAAAZgAA//+22///ADqQAAAAAAAAAAAAAAAAOgAA/9uQtv//AABmAAAAAAAAAAAAAAAAAAAAZgAA//+2////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////Zrb/AAAAkDoA///b2///ADqQAAAA/7Zmtv//AABmZgAAtv+2AABmAAAAAAAA/7Zm////tv//AABmOgAA/9uQ////////AGa2AAAAAAAAAAAAkDoA///b////////AGa2AAAAAAAAAAAAZgAA//+2////////tv//AABmAAAAOgAAkLaQAAA6ZgAA//+2////////AGa2AAAAAAAAOgAA/9uQ////////tv//AABmAAAAOgAAkLaQAAA6ZgAA//+2////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////tv//AABmOgAA/9uQ////////////////////////////////////////////////////////////////////////////////////////kNv/AAA6ZgAA//+2////////////////////////////////////////////////////kNv/AAA6ZgAA//+2////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////tv//AABmOgAA/9uQ////////////////////////////////////////////////////////////////////////////////////////kNv/AAA6ZgAA//+2////////////////////////////////////////////////////kNv/AAA6ZgAA//+2////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////tv//AABmOgAA/9uQ////////////////////////////////////////////////////////////////////////////////////////kNv/AAA6ZgAA//+2////////////////////////////////////////////////////kNv/AAA6ZgAA//+2////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////2///ADqQAAAAAAAAAAAAZgAA//+2////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////2///ADqQAAAAAAAAAAAAAAAAAAAA/7Zm////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////2///ADqQAAAAkDoA///b////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////2///ADqQOgAA/9uQ////////////OpDbAAAAZgAA//+2////2///ADqQAAAAAAAAAAAAtmYA////////////////////////tv//AABmZgAA//+2tv//AABmZgAA//+2////OpDbAAAA25A6////tv//AABmOgAA/9uQ2///ADqQAAAAAAAAkJA6AABmZgAA//+2////kNv/AAA6AAAAZgAAkNu2AAA6ZgAA//+2////2///ADqQAAAAAAAAAAAAkDoA///b////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////2///ADqQOgAA/9uQ////////kNv/AAA6AAAAZgAA//+2tv//AABmAAAAAAAAAAAAAAAAAAAAkDoA///b////////////////tv//AABmZgAA//+2tv//AABmZgAA//+2////OpDbAAAA25A6////tv//AABmOgAA/9uQOpDbAAAAAAAAAAAAAAAAAAAAZgAA//+2tv//AABmAAAAAAAAAAAAOjoAAAA6ZgAA//+2tv//AABmAAAAAAAAAAAAAAAAkDoA///b////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////2///ADqQOgAA/9uQ////2///ADqQAAAAAAAAZgAA//+2Zrb/AAAAZgAA//+2////tv//AABmAAAA/7Zm////////////////tv//AABmZgAA//+2tv//AABmZgAA//+2////OpDbAAAA25A6////tv//AABmOgAA/9uQZrb/AAAA25A6////tv//AABmZgAA//+2Zrb/AAAAZgAA//+2////Zrb/AAAAZgAA//+2Zrb/AAAAkDoA///b////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////2///ADqQOgAA/9uQ////OpDbAAAAZmYAAABmZgAA//+2OpDbAAAAtmYA////////////AGa2AAAA25A6////////////////tv//AABmZgAA//+2tv//AABmZgAA//+2////OpDbAAAA25A6////tv//AABmOgAA/9uQ////AGa2AAAAAAAAAAAAAAAAZgAA//+2OpDbAAAAtmYA////////tv//AABmZgAA//+2Zrb/AAAAAAAAAAAAAAAAAAAAAAAA25A6////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////2///ADqQOgAA/9uQkNv/AAA6ZgAAtv+2AABmZgAA//+2Zrb/AAAAOgAA/9uQ////tv//AABmAAAA/7Zm////////////////tv//AABmZgAA//+2tv//AABmAAAA/7Zm////AGa2AAAAkDoA///bkNv/AAA6OgAA/9uQ////////////////tv//AABmZgAA//+2Zrb/AAAAZgAA//+2////Zrb/AAAAZgAA//+2Zrb/AAAAZgAA//+2////OpDbAAAA25A6////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////2///ADqQOgAA29uQADqQAAAA/7Zmtv//AABmZgAA//+22///ADqQAAAAAAAAAAAAAAAAAAAAZgAA//+2////////////////tv//AABmZgAA//+2tv//AABmOgAAADo6AAAAAAAAAAAAOjo6AAAAAAAAAAAAZgAA//+22///ADqQAAAAAAAAAAAAAAAAkDoA///b2///ADqQAAAAAAAAAAAAAAAAAAAAZgAA//+22///ADqQAAAAAAAAAAAAAAAAOgAA/9uQ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////2///ADqQOgAAOmZmAAAAtmYA////tv//AABmZgAA//+2////////AGa2AAAAAAAAAAAAkDoA///b////////////////////tv//AABmZgAA//+2tv//AABmZgAAtv+2AABmAAAAtmYA////AGa2AAAAAAAA/7Zm////////AGa2AAAAAAAAAAAAZgAA//+2////////tv//AABmAAAAOgAAttuQAABmZgAA//+2////////AGa2AAAAAAAAOgAA/9uQ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////2///ADqQAAAAAAAAZgAA//+2////tv//AABmZgAA//+2////////////////////////////////////////////////////tv//AABmZgAA//+2////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////2///ADqQAAAAAAAA/7Zm////////tv//AABmZgAA//+2////////////////////////////////////////////////////tv//AABmZgAA//+2////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////2///ADqQAAAAtmYA////////////tv//AABmZgAA//+2////////////////////////////////////////////////////tv//AABmZgAA//+2////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////";

const INITIAL_VALUES = {
  "first_name": "",
  "last_name": "",
  "email": "",
  "phone": "",
  "photo": DEFAULT_PROFILE,
}


const validationSchema = yup.object({
  email: yup
    .string()
    .email('Enter a valid email')
    .required('Email is required'),
  phone: yup
    .string()
    .test('len', 'Enter a valid phone number', val => val?.length === 10)
    .required('Phone number is required'),
});


export default function Contact() {
  const navigate = useNavigate();
  let {id} = useParams();
  const isUpdate = !!id;
  const contact = useContact(id);
  const updateContact = useContactUpdate();
  const insertContact = useContactCreate();
  const deleteContact = useContactDelete();
  const updateMutation = isUpdate ? updateContact.mutateAsync : insertContact.mutateAsync;
  const info = contact.data;
  const anyLoading = contact.isLoading || updateContact.isLoading || insertContact.isLoading || deleteContact.isLoading;

  const handleDelete = async () => {
    await deleteContact.mutateAsync(id);
    navigate("/");
  }

  const handleSubmit = async (data) => {
    const result = await updateMutation(data);
    if (!isUpdate) {
      navigate(`/contact/${result.id}`);
    }
  }

  const formik = useFormik({
    initialValues: info || INITIAL_VALUES,
    validationSchema: validationSchema,
    onSubmit: handleSubmit,
    enableReinitialize: true
  })

  if (anyLoading || !formik.values) return 'Loading...';


  const handleImageUpload = async (e) => {
    e.preventDefault();
    let reader = new FileReader();
    reader.readAsDataURL(e.currentTarget.files[0]);
    reader.onloadend = await function () {
      if (reader.result.length > IMAGE_SIZE_LIMIT) {
        alert("Image size should be less than 2MB");
      } else {
        formik.setFieldValue("photo", reader.result);
      }
    }
  }

  return (
    <ContactWrapper>
      <form onSubmit={formik.handleSubmit}>
        <Grid container spacing={1} sx={{
          '& .MuiTextField-root': {my: 1},
        }}>
          <Grid item xs={12}>
            <ProfileImage src={formik.values.photo} alt="profile"/>
          </Grid>
          <Grid item xs={12}>
            <input type="file" accept="image/*" onChange={handleImageUpload}/>
          </Grid>
          <Grid item xs={6}>
            <TextField
              fullWidth
              name="first_name"
              label="First Name"
              value={formik.values.first_name}
              onChange={formik.handleChange}
            />
          </Grid>
          <Grid item xs={6}>
            <TextField
              fullWidth
              name="last_name"
              label="Last Name"
              value={formik.values.last_name}
              onChange={formik.handleChange}
            />
          </Grid>
          <Grid item xs={12}>
            <TextField
              fullWidth
              name="email"
              label="Email"
              value={formik.values.email}
              onChange={formik.handleChange}
              error={formik.touched.email && Boolean(formik.errors.email)}
              helperText={formik.touched.email && formik.errors.email}
            />
          </Grid>
          <Grid item xs={12}>
            <TextField
              fullWidth
              name="phone"
              label="Phone Number"
              value={formik.values.phone}
              onChange={formik.handleChange}
              error={formik.touched.phone && Boolean(formik.errors.phone)}
              helperText={formik.touched.phone && formik.errors.phone}
            />
          </Grid>
          <Grid item xs={6}>
            <Button type="submit" color="primary" variant="contained"
                    disabled={anyLoading}>{isUpdate ? 'Update' : 'Create'} Contact</Button>
          </Grid>
          <Grid item xs={6}>
            <Button color="error" variant="contained" onClick={handleDelete} disabled={anyLoading}>Delete
              Contact
            </Button>
          </Grid>
        </Grid>
      </form>

    </ContactWrapper>

  )
}